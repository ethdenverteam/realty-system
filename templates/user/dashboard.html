{% extends "layout.html" %}

{% block title %}–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è - Realty System{% endblock %}

{% block header_title %}üè† –ú–æ—è –ø–∞–Ω–µ–ª—å{% endblock %}

{% block header_actions %}
    <button class="btn-icon" onclick="logout()" title="–í—ã–π—Ç–∏">
        <i class="bi bi-box-arrow-right"></i>
    </button>
{% endblock %}

{% block content %}
<div id="error" class="alert alert-danger" style="display: none;"></div>

<div class="stats-grid" id="statsGrid">
    <div class="stat-card">
        <div class="stat-value" id="objectsCount">-</div>
        <div class="stat-label">–ú–æ–∏ –æ–±—ä–µ–∫—Ç—ã</div>
    </div>
    <div class="stat-card">
        <div class="stat-value" id="publicationsCount">-</div>
        <div class="stat-label">–ü—É–±–ª–∏–∫–∞—Ü–∏–π</div>
    </div>
    <div class="stat-card">
        <div class="stat-value" id="todayPublications">-</div>
        <div class="stat-label">–°–µ–≥–æ–¥–Ω—è</div>
    </div>
    <div class="stat-card">
        <div class="stat-value" id="accountsCount">-</div>
        <div class="stat-label">–ê–∫–∫–∞—É–Ω—Ç–æ–≤</div>
    </div>
</div>

<div class="card">
    <div class="card-header">–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</div>
    <div class="d-flex flex-wrap gap-2">
        <a href="/system/user/dashboard/objects/create" class="btn btn-primary btn-sm">
            <i class="bi bi-plus-circle"></i> –°–æ–∑–¥–∞—Ç—å –æ–±—ä–µ–∫—Ç
        </a>
        <a href="/system/user/dashboard/objects" class="btn btn-primary btn-sm">
            <i class="bi bi-list-ul"></i> –ú–æ–∏ –æ–±—ä–µ–∫—Ç—ã
        </a>
    </div>
</div>

{% if user.web_role == 'admin' %}
<div class="card">
    <div class="card-header">–ê–¥–º–∏–Ω —Ñ—É–Ω–∫—Ü–∏–∏</div>
    <a href="/system/admin/dashboard" class="btn btn-danger btn-sm">
        <i class="bi bi-shield-lock"></i> –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å
    </a>
</div>
{% endif %}
{% endblock %}

{% block bottom_nav %}
<nav class="bottom-nav">
    <a href="/system/user/dashboard" class="nav-item active">
        <i class="bi bi-house-door"></i>
        <span>–ì–ª–∞–≤–Ω–∞—è</span>
    </a>
    <a href="/system/user/dashboard/objects" class="nav-item">
        <i class="bi bi-list-ul"></i>
        <span>–û–±—ä–µ–∫—Ç—ã</span>
    </a>
    <a href="/system/user/dashboard/objects/create" class="nav-item">
        <i class="bi bi-plus-circle"></i>
        <span>–°–æ–∑–¥–∞—Ç—å</span>
    </a>
    {% if user.web_role == 'admin' %}
    <a href="/system/admin/dashboard" class="nav-item">
        <i class="bi bi-shield-lock"></i>
        <span>–ê–¥–º–∏–Ω</span>
    </a>
    {% endif %}
</nav>
{% endblock %}

{% block extra_js %}
<script>
    if (!checkAuth()) return;
    
    async function loadStats() {
        try {
            const res = await apiFetch('/user/dashboard/stats');
            if (res.ok) {
                const stats = await res.json();
                document.getElementById('objectsCount').textContent = stats.objects_count || 0;
                document.getElementById('publicationsCount').textContent = stats.total_publications || 0;
                document.getElementById('todayPublications').textContent = stats.today_publications || 0;
                document.getElementById('accountsCount').textContent = stats.accounts_count || 0;
            }
        } catch (error) {
            console.error('Error loading stats:', error);
            document.getElementById('error').textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏';
            document.getElementById('error').style.display = 'block';
        }
    }
    
    loadStats();
</script>
{% endblock %}

